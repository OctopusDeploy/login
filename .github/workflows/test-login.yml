name: Test login
on:
  workflow_dispatch:
    inputs:
      server:
        type: string
        description: The url of the Octopus Instance
        required: true
      service_account_id:
        type: string
        description: The id of the service account to login for
        required: true

jobs:
  login:
    permissions:
      id-token: write # This is required for requesting the JWT
      contents: read # This is required for actions/checkout
    runs-on: ubuntu-latest
    name: Test login to Octopus
    steps:
      - uses: actions/checkout@v3

      - name: Login to Octopus
        id: login
        uses: ./
        with:
          server: ${{ inputs.server }}
          service_account_id: ${{ inputs.service_account_id }}

      - name: Print Octopus credential environment variables
        run: |
          echo "OCTOPUS_URL = $OCTOPUS_URL"
          echo "OCTOPUS_ACCESS_TOKEN = $OCTOPUS_ACCESS_TOKEN"
